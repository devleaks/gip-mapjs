<!DOCTYPE html>
<html>

<head>
    <title>New Simplified Elegant GIP Viewer</title>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="../src/images/favicons/favicon-32x32.png" />
    <!-- MAP & LEAFLET PLUGINS -->
    <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="../node_modules/leaflet-pulse-icon/src/L.Icon.Pulse.css" />
    <link rel="stylesheet" href="../node_modules/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="../node_modules/leaflet-groupedlayercontrol/dist/leaflet.groupedlayercontrol.min.css" />
    <link rel="stylesheet" href="../node_modules/beautifymarker/leaflet-beautify-marker-icon.css" />
    <link rel="stylesheet" href="../node_modules/leaflet-sidebar-v2/css/leaflet-sidebar.css" />
    <link rel="stylesheet" href="../lib/leaflet-betterscale/L.Control.BetterScale.css" />
    <link rel="stylesheet" href="../node_modules/leaflet-search/dist/leaflet-search.src.css" />
    <link rel="stylesheet" href="../node_modules/leaflet-easybutton/src/easy-button.css" />
    <link rel="stylesheet" href="../lib/line-awesome/css/line-awesome.css" />
    <!-- DEBUG -->
    <link rel="stylesheet" href="../lib/Leaflet.zoomdisplay/dist/leaflet.zoomdisplay.css" />
    <!-- DASHBOARD FRAMEWORK -->
    <link rel="stylesheet" href="../src/css/materialadmin.css" />
    <link rel="stylesheet" href="../src/css/tagsort.css" />
    <!-- OSCARS GIP OVERRIDES -->
    <link rel="stylesheet" href="../src/L-oscars.css" />
</head>

<body>
    <div id="map" class="sidebar-map eblg"></div>
    <!-- MAP & LEAFLET PLUGINS -->
    <script src="../node_modules/leaflet/dist/leaflet.js"></script>
    <script src="../node_modules/leaflet-realtime/dist/leaflet-realtime.js"></script>
    <script src="../node_modules/leaflet-pulse-icon/src/L.Icon.Pulse.js"></script>
    <script src="../node_modules/beautifymarker/leaflet-beautify-marker-icon.js"></script>
    <script src="../node_modules/leaflet-rotatedmarker/leaflet.rotatedMarker.js"></script>
    <script src="../node_modules/leaflet-groupedlayercontrol/dist/leaflet.groupedlayercontrol.min.js"></script>
    <script src="../node_modules/leaflet-sidebar-v2/js/leaflet-sidebar.js"></script>
    <script src="../node_modules/leaflet-canvasicon/leaflet-canvasicon.js"></script>
    <script src="../node_modules/leaflet-piechart/leaflet-piechart.js"></script>
    <script src="../node_modules/leaflet-search/dist/leaflet-search.src.js"></script>
    <script src="../node_modules/leaflet-easybutton/src/easy-button.js"></script>
    <script src="../lib/leaflet-betterscale/L.Control.BetterScale.js"></script>
    <!-- OSCARS LAYER CLASSES & UTILITIES -->
    <script src="../node_modules/jsonpath-plus/dist/index-umd.js"></script>
    <script src="../node_modules/mustache/mustache.js"></script>
    <script src="../node_modules/moment/moment.js"></script>
    <script src="../node_modules/@turf/turf/turf.min.js"></script>
    <script src="../node_modules/@mapbox/geojsonhint/geojsonhint.js"></script>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../node_modules/peity/jquery.peity.js"></script>
    <script src="../node_modules/renderjson/renderjson.js"></script>
    <script src="../src/js/jquery.sieve.js"></script>
    <script src="../src/js/tagsort.min.js"></script>
    <script src="../src/js/sortElements.js"></script>
    <script src="../src/js/jquery.growl.js"></script>
    <script src="../src/js/parse_metar.js"></script>
    <!-- OSCARS -->
    <script src="../src/L-oscars-util-min.js"></script>
    <script src="../src/L-oscars-dashboard-min.js"></script>
    <script src="../src/L-oscars-map-min.js"></script>
    <script src="../src/L-oscars-zone-group-min.js"></script>
    <script src="../src/L-oscars-device-group-min.js"></script>
    <script src="../src/L-oscars-wire-min.js"></script>
    <!-- ZONES -->
    <script src="data/eblg-parkings.js"></script>
    <script>
    /* ENVIRONMENT
     */
    var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var OpenStreetMap_France = L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
        maxZoom: 20,
        attribution: '&copy; Openstreetmap France | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        maxZoom: 17,
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    });

    var Stadia_AlidadeSmoothDark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
        maxZoom: 20,
        attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
    });

    var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });


    var baseLayers = {
        "OSM France": OpenStreetMap_France,
        "OpenTopo": OpenTopoMap,
        "Stadia Alidade Smooth Dark": Stadia_AlidadeSmoothDark,
        "ESRI World Imagery": Esri_WorldImagery
    };

    var airportOverlay = new L.ImageOverlay("data/EBLG_GMC01_v13.svg", new L.LatLngBounds(
        new L.LatLng(50.62250, 5.41630), // en bas à gauche
        new L.LatLng(50.65655, 5.47567)), { // en haut à droite 
        opacity: 0.8
    });

    var airportNightOverlay = new L.ImageOverlay("data/EBLG_GMC01_v13-night.svg", new L.LatLngBounds(
        new L.LatLng(50.62250, 5.41630), // en bas à gauche
        new L.LatLng(50.65655, 5.47567)), { // en haut à droite 
        opacity: 1
    });

    /* GIP OPTIONS
     */
    var dashboard_options = {
            elemprefix: "",
            msgprefix: "GIP-",
            websocket: 'ws://localhost:8051',
            reconnect_retry: 120, // seconds
            debug: false
        },
        map_options = {
            map_id: "map",
            map_message: "map",
            center: [50.64, 5.445],
            zoom: 15,
            layers: [OpenStreetMap_France],
            layerControl: {
                baseLayers: baseLayers,
                overlays: {
                    "<span style='color: #0C64AF;'><img src='data/liegeairport-14.png'>&nbsp;Liège Airport</span>": {
                        "<span style='color: #EE850A;'>Day</span>": airportOverlay,
                        "<span style='color: #EE850A;'>Night</span>": airportNightOverlay
                    }
                },
                options: { groupCheckboxes: true, collapsed: false }
            },
            layerControlOptions: { useGrouped: true, groupCheckboxes: true, collapsed: false },
            name: "GIPVIEWER",
            display_name: "GIP Viewer",
            sidebar: true,
            reset: true, // includes overview as well
            wire: true,
            search: false,
            betterScale: true,
            track: false,
            speedVector: true,
            info: false,
            info_id: "info",
            info_content_id: "device-info",
            voice: false,
            stylesets: false,
            about: true,
            client: "oscars",
            debug: false
        },
        wire_options = {
            wire_id: "wire_id",
            wire_message: "wire",
            voice: false,
            debug: false
        }


    /*  INITIALIZE OSCARS GIP VIEWER
     */
    var dashboard = Oscars.Dashboard

    dashboard.init(dashboard_options)

    map_options.dashboard_options = dashboard_options
    map_options.wire_options = wire_options
    var map = Oscars.Map.map(map_options, dashboard)

    wire_options.dashboard_options = dashboard_options
    var wire = Oscars.Wire.init(wire_options, dashboard)


    /* POPULATE WITH BASIC DATA
     */
    const tower = [50.63725474594362, 5.453993082046508]
    var radar = L.layerGroup().addTo(map)
    L.circle(tower, { radius: 80000, color: "darkred", opacity: 0.5, weight: 1, fill: false }).addTo(radar)
    L.circle(tower, { radius: 160000, color: "darkblue", opacity: 0.4, weight: 1, fill: false }).addTo(radar)


    var aircrafts = Oscars.deviceGroup({
        "type": "FeatureCollection",
        "properties": {
            "name": "AIRCRAFTS",
            "display_name": "Aircfrafts",
            "type": "AIRCRAFT",
            "display_type": "Aircfraft",
            "status": "ACTIVE"
        },
        "features": []
    }, {
        greyOut: 600000, // 10 mins
        takeOut: 1800000, // 30 mins
        search: true
    }).addTo(map);


    var services = Oscars.deviceGroup({
        "type": "FeatureCollection",
        "properties": {
            "name": "SERVICES",
            "display_name": "Service vehicles",
            "type": "SERVICE",
            "display_type": "Service",
            "status": "ACTIVE"
        },
        "features": []
    }, {
        greyOut: 600000, // 10 mins
        takeOut: 1800000, // 30 mins
        search: true
    }).addTo(map);


    var trucks = Oscars.deviceGroup({
        "type": "FeatureCollection",
        "properties": {
            "name": "TRUCKS",
            "display_name": "Trucks",
            "type": "TRUCK",
            "display_type": "Truck",
            "status": "ACTIVE"
        },
        "features": []
    }, {
        greyOut: 600000, // 10 mins
        takeOut: 1800000, // 30 mins
        search: true
    }).addTo(map);


    var parkingStyle = {
        available: {
            markerSymbol: "map-marker",
            markerSize: 24, // px
            markerColor: "rgb(0,128,256)", // lighter blue
            color: "green", // stroke color
            opacity: 0.6, // stroke opacity 0 = transparent
            weight: 1, // stroke width
            fillColor: "green", // fill color
            fillOpacity: 0.2, // fill opacity 1 = opaque
            fillPattern: "solid", // fill pattern (currently unused)
            inactiveMarkerColor: "darkgrey"
        },
        busy: {
            markerSymbol: "map-marker",
            markerSize: 24, // px
            markerColor: "rgb(0,128,256)", // lighter blue
            color: "red", // stroke color
            opacity: 0.6, // stroke opacity 0 = transparent
            weight: 1, // stroke width
            fillColor: "red", // fill color
            fillOpacity: 0.2, // fill opacity 1 = opaque
            fillPattern: "solid", // fill pattern (currently unused)
            inactiveMarkerColor: "darkgrey"
        }
    }

    var parkings = Oscars.zoneGroup({
        "type": "FeatureCollection",
        "properties": {
            "name": "PARKINGS",
            "display_name": "Parkings",
            "type": "PARKING",
            "display_type": "Parking",
            "status": "ACTIVE"
        },
        "features": eblgParkings.features
    }, {
        gipDefaults: {
            STYLE: parkingStyle.available
        }
    }).addTo(map);


    function parking(name, avail) {
        const parr = eblgParkings.features.filter(f => f.properties.name == name)
        if (parr.length > 0) {
            const park = parr[0]
            park.properties._style = parkingStyle[avail]
            parkings.update(park)
        }

    }
    parking(124, "busy")


    if (map_options.debug) // ping at tower if debugging
        L.marker(tower, { icon: L.icon.pulse({ iconSize: [10, 10], color: 'red' }) }).addTo(radar);
    </script>
</body>

</html>